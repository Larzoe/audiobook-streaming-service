{
  "steps": [
    {
      "name": "gcr.io/cloud-builders/docker",
      "args": [
        "build",
        "-t",
        "us-central1-docker.pkg.dev/essential-tower-422709-k9/accounts/accounts:latest",
        "-f",
        "./accounts/Dockerfile",
        "./accounts"
      ]
    },
    {
      "name": "gcr.io/cloud-builders/docker",
      "args": [
        "push",
        "us-central1-docker.pkg.dev/essential-tower-422709-k9/accounts/accounts:latest"
      ]
    },
    {
      "name": "gcr.io/cloud-builders/docker",
      "args": [
        "build",
        "-t",
        "us-central1-docker.pkg.dev/essential-tower-422709-k9/catalog/catalog:latest",
        "-f",
        "./catalog/Dockerfile",
        "./catalog"
      ]
    },
    {
      "name": "gcr.io/cloud-builders/docker",
      "args": [
        "push",
        "us-central1-docker.pkg.dev/essential-tower-422709-k9/catalog/catalog:latest"
      ]
    },
    {
      "name": "gcr.io/cloud-builders/docker",
      "args": [
        "build",
        "-t",
        "us-central1-docker.pkg.dev/essential-tower-422709-k9/payments/payments:latest",
        "-f",
        "./payments/Dockerfile",
        "./payments"
      ]
    },
    {
      "name": "gcr.io/cloud-builders/docker",
      "args": [
        "push",
        "us-central1-docker.pkg.dev/essential-tower-422709-k9/payments/payments:latest"
      ]
    },
    {
      "name": "gcr.io/cloud-builders/docker",
      "args": [
        "build",
        "-t",
        "us-central1-docker.pkg.dev/essential-tower-422709-k9/publisher/publisher:latest",
        "-f",
        "./publisher/Dockerfile",
        "./publisher"
      ]
    },
    {
      "name": "gcr.io/cloud-builders/docker",
      "args": [
        "push",
        "us-central1-docker.pkg.dev/essential-tower-422709-k9/publisher/publisher:latest"
      ]
    },
    {
      "name": "gcr.io/cloud-builders/gcloud",
      "entrypoint": "bash",
      "env": [
        "CLOUDSDK_COMPUTE_ZONE=europe-west4",
        "CLOUDSDK_CONTAINER_CLUSTER=stroystream-cluster"
      ],
      "args": [
        "-c",
        "gcloud container clusters get-credentials stroystream-cluster --zone europe-west4 --project essential-tower-422709-k9"
      ]
    },
    {
      "name": "gcr.io/cloud-builders/kubectl",
      "args": [
        "apply",
        "-f",
        "k8s/apps/production/accounts.yaml"
      ]
    },
    {
      "name": "gcr.io/cloud-builders/kubectl",
      "args": [
        "apply",
        "-f",
        "k8s/apps/production/catalog.yaml"
      ]
    },
    {
      "name": "gcr.io/cloud-builders/kubectl",
      "args": [
        "apply",
        "-f",
        "k8s/apps/production/payments.yaml"
      ]
    },
    {
      "name": "gcr.io/cloud-builders/kubectl",
      "args": [
        "apply",
        "-f",
        "k8s/apps/production/publishers.yaml"
      ]
    }
  ],
  "images": [
    "us-central1-docker.pkg.dev/essential-tower-422709-k9/accounts/accounts:latest",
    "us-central1-docker.pkg.dev/essential-tower-422709-k9/catalog/catalog:latest",
    "us-central1-docker.pkg.dev/essential-tower-422709-k9/payments/payments:latest",
    "us-central1-docker.pkg.dev/essential-tower-422709-k9/publisher/publisher:latest"
  ]
}
